<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista de produtos</title>
</head>
<body>
    <div th:if="${user.isLoggedIn}">
        <a th:href="@{/logout}">Logout</a>
        <div th:if="${resultNomeLogin != null}">
            <p>Ola: <span th:text="${resultNomeLogin[0]['nome']}"></span></p>
        </div>
    </div>
    <div th:unless="${user.isLoggedIn}">
        <p>Não logado</p>
        <a th:href="@{/login}">Login</a>
    </div>
    
    <h1>Lista de produtos</h1>
    <table>
        <tr>
            <th>Produtos</th>
        </tr>
        <tr th:each="resultado : ${resultados}">
            <td>
                <a th:href="@{'/produto/' + ${resultado['id_produto']}}"><span th:text="${resultado['nome']}"></span></a>
            </td>
        </tr>
    </table>
    <div class="cart-sidebar">
        <h2>Carrinho de Compras</h2>
        <ul id="cart-items">
            <!-- Itens do carrinho serão atualizados aqui -->
        </ul>
        <button id="limpar-carrinho">Limpar Carrinho</button>
    </div>
    
    
    <script type="text/javascript">
        // Função para atualizar a barra lateral do carrinho em tempo real
        function atualizarCarrinho() {
    fetch('/carrinho') // Endpoint para obter itens do carrinho
        .then(function (response) {
            return response.json();
        })
        .then(function (data) {
            var cartItems = data.itens;
            var cartItemsList = document.getElementById('cart-items');

            cartItemsList.innerHTML = '';
            cartItems.forEach(function (item) {
                var listItem = document.createElement('li');
                listItem.textContent = "Nome: " + item.nome + " - Preço: $" + item.preco + " - Quantidade: " + item.quantidade;
                cartItemsList.appendChild(listItem);
        
            });
            atualizarCarrinho();
        });
}
        document.addEventListener('DOMContentLoaded', function () {
            var limparCarrinhoButton = document.getElementById('limpar-carrinho');
        
            limparCarrinhoButton.addEventListener('click', function () {
                fetch('/carrinho/limpar', { method: 'POST' })
                    .then(function (response) {
                        return response.json();
                    })
                    .then(function (data) {
                        var message = data.message;
                        alert(message);
                        atualizarCarrinho();
                    });
            });
        });
        atualizarCarrinho();
    </script>
</body>
</html>
